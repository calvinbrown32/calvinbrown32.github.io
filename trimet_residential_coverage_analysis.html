</html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover">

  <title>Calvin Brown</title>

  <meta name="author" content="" />
  <meta name="description" content="Urban Planner, Data Analyst, Cartographer, Transit and Safe Streets Advocate">


<link rel="stylesheet" href="https://calvinbrown32.github.io//css/bootstrap4.min.css" />
<link rel="stylesheet" href="https://calvinbrown32.github.io//css/bootstrap-social.css" />
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css" />

 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
 <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


<link rel="stylesheet" href="https://calvinbrown32.github.io/css/pygment_highlights.css" />

<link rel="stylesheet" href="https://calvinbrown32.github.io/css/main.css" />


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />


    <script type="text/javascript" src='https://calvinbrown32.github.io/JWAFiles/maxline.js'></script>
    <script type="text/javascript" src='https://calvinbrown32.github.io/JWAFiles/route2inboundline.js'></script>
    <script type="text/javascript" src='https://calvinbrown32.github.io/JWAFiles/route2outboundline.js'></script>
    <script type="text/javascript" src='https://calvinbrown32.github.io/JWAFiles/2021/isos_w_pop_max_yellow_stops.js'></script>
    <script type="text/javascript" src='https://calvinbrown32.github.io/JWAFiles/2021/isos_w_pop_route_2_inbound_and_io.js'></script>
    <script type="text/javascript" src='https://calvinbrown32.github.io/JWAFiles/2021/isos_w_pop_route_2_outbound.js'></script>
    <script type="text/javascript" src='https://calvinbrown32.github.io/JWAFiles/2021/transit_stops_w_pop_max_yellow_stops.js'></script>
    <script type="text/javascript" src='https://calvinbrown32.github.io/JWAFiles/2021/transit_stops_w_pop_route_2_inbound_and_io.js'></script>
    <script type="text/javascript" src='https://calvinbrown32.github.io/JWAFiles/2021/transit_stops_w_pop_route_2_outbound.js'></script>

     <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js" integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg==" crossorigin=""></script>


	<style>
		html, body {
			height: 100%;
			margin: 0;
		}
		#map {
			width: 600px;
			height: 400px;
		}
	</style>

	<style>#map { width: 99%; height: 500px; }
.info { padding: 6px 8px; font: 14px/16px Arial, Helvetica, sans-serif; background: white; background: rgba(255,255,255,0.8); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px; } .info h4 { margin: 0 0 5px; color: #777; }
.legend { text-align: left; line-height: 18px; color: #555; } .legend i { width: 18px; height: 18px; float: left; margin-right: 8px; opacity: 0.7; }</style>


</head>
  <!-- The head should not be edited -->


<body>


<!-- This is the navbar and should not be edited -->
<nav class="navbar navbar-expand-md fixed-top navbar-light bg-light">
    <a class="navbar-brand-custom" href="http://calvinbrown32.github.io">Calvin Brown</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="collapsibleNavbar">
    <ul class="navbar-nav ml-auto">

    <!-- ** FUTURE ABOUT PAGE HERE:
        <li class="nav-item-custom">
          <a class="nav-link" href="https://calvinbrown32.github.io/resume">About</a> </li>
    ** -->

   <!-- ** FUTURE ABOUT PAGE HERE:
        <li class="nav-item-custom">
        <a class="nav-link" href="http://127.0.0.1:5000/portfolio2">Portfolio</a> </li>
   ** -->

       <li class="nav-item-custom">
       <a class="nav-link" href="https://calvinbrown32.github.io/essays">Essays</a> </li>

        <li class="nav-item-custom">
        <a class="nav-link" href="https://calvinbrown32.github.io/resume">Resume</a> </li>

       <li class="nav-item-custom">
       <a class="nav-link" href="https://calvinbrown32.github.io/contact">Contact</a> </li>

    </ul>
  </div>
</nav>

<!-- The header below should be modified or removed depending on the theme of the website.-->


<header class="header-section ">
<div class="intro-header no-img">
  <div class="container">
    <div class="row">
      <div class="col">
        <div class="page-heading">
          <h1>Portland TriMet Residential Coverage</h1>

            <hr class="small">
            <span class="page-subheading">Residential Coverage Analysis of Route 2 and Max Yellow Line</span>
        </div>
      </div>
    </div>
  </div>
</div>
</header>

<!-- The main body content should be added here -->
<div class="container">
<div class="row">
<div class="col">
 <!--
  <p>
       <i> This PDF was generated from <a href="https://calvinbrown32.github.io/trimet_residential_coverage_analysis.html">https://calvinbrown32.github.io/trimet_residential_coverage_analysis.html</a></i>
    </p>
    -->
<p>
    This residential coverage analysis estimates the number of inhabitants within ½ mile of each station on the MAX Yellow Line and each bus stop of the inbound and outbound Route 2 bus. Understanding how many people live and quick access to transit is crucial to understanding and predicting ridership, measuring the appropriateness of bus stop location and spacing,  and assessing myriad other factors that play into difficult decisions regarding transit investment and planning. The interactive map and charts I created allow users to explore and understand this important statistic, and give them the ability to pinpoint bus stops that have exceptionally low or high residential coverage.
</p>
    <h4> Methodology  </h4>
<p>
From downloading the Census block group level population data, to creating the final data outputs, interactive maps, and charts, this entire process has been coded using open source tools in Python and Javascript. The code used in this analysis can be viewed on <a href="https://github.com/calvinbrown32/JWA_2021/blob/master/osm_network_analysis_and_residential_coverage_area_creation.ipynb">Github</a>. There are many advantages to using code to conduct the analysis. The main advantage is scalability. The code used for this analysis can be used to quickly conduct the same analysis for any transit system in the world. The code is well documented,  and the code itself is documentation of the process. This allows the work to be replicated, peer reviewed, and checked for quality assurance. The code can be leveraged across projects, across time and geographies, and can be further developed into increasingly complex analyses, interactive applications or web tools.
<br>

    The following steps were taken in the analysis:
</p>

    <ol>
  <li>
First, Python was used to download the 2019 5-year American Community Survey (ACS) population data at the block group level from the Census API, and merge the population data with the Census block group level geographies.
  </li>
  <li>
Next, I used OSMnx to download and process a topological street network for Multnomah County, and create isochrones for each transit stop that approximate 1/2 miles distance traveling along the walkable street network.
  </li>
  <li>
The isochrones are dissolved, resulting in polygons in show everywhere that is within 1/2 mile travel on the walkable network from any of the transit stops on the route. Below is an image of the dissolved isochrones for the Max Yellow line:
  </li>
<br>
        <img src="https://calvinbrown32.github.io/JWAFiles/2021/Dissolved_Iso.png" alt="dissolved_iso" width= 35%>
<br>
        <br>
<li>
The area within the dissolved isochrones is next split into Voronoi polygons. These polygons demarcate an area for each individual transit stop that consists of all points within the dissolved isochrone layer that are closer to that transit stop than to any other stop. This step ensures that residents living near two or more stops are not double counted. These polygons are the residential coverage areas for each transit stop. See an image of these areas below:
</li>
<br>
        <img src="https://calvinbrown32.github.io/JWAFiles/2021/Voronoi_Polys.png" alt="voronoi_polys" width= 35%>
<br>
        <br>
        <li>
The Census population data is at the block group level. The block group geographies do no align with the residential coverage areas created in earlier steps, and so additional step will need to be taken to estimate what proportion of the residents counted in the block groups live within the residential coverage areas. First, the block groups are clipped to the residential coverage areas, and the areal proportion of each block group falling fully or partially within the residential coverage areas is calculated. See an image below of the block group areas clipped to the residential coverage areas.
</li>
        <br>
<img src="https://calvinbrown32.github.io/JWAFiles/2021/Voronoi_BG_Intersect.png
      " alt="voronoi_block_groups" width= 65%>
        <br>
        <br>

<li>
Next, the total population figure for each block group is multiplied by the areal proportion calculated in step 6 above.
</li>

<li>
For each residential coverage area, I summed the proportional population estimates of every block group falling within it. The resulting sum is the estimated number of people living within 1/2 mile network distance from each transit stop.
</li>
</ol>

    <br>
<br>


	<h4> TriMet Residential Coverage Interactive Map</h4>
    <p>
      This map allows users to view the residential coverage of each transit stop. The residential coverage area for each stop is defined as the region around a given transit stop consisting of all points closer to that transit stop than any other transit stop on the same route, and within ½ mile network distance from the stop. Click on the layers button in the upper righthand corner to view different routes. Click on map features to view the residential coverage for each transit stop.
    </p>
	<br>

<div class="container">
<div class="row align-items-center">
<div class="col-sm-12  py-4">
	<div id='map'class="mx-auto"></div>
</div>
</div>
</div>
	<br>
	<br>
	<hr>

    <div class = "row">
	<div class="col-md-12 text-center">
	<img src="https://calvinbrown32.github.io/JWAFiles/MaxlineChart-01.jpg
      " alt="maxchart" width= 60%>


	<br>
	<br>
	<hr>


	<img src="https://calvinbrown32.github.io/JWAFiles/route2outboundchart.jpg
      " alt="route2outboundchart" width= 70%>

	<br>
	<br>
	<hr>

	<img src="https://calvinbrown32.github.io/JWAFiles/route2inboundchart.jpg
      " alt="route2inboundchart" width= 70%>
	   </div>
</div>

    <br>
<br>
<br>
Code used in the analysis can be viewed at <a href="https://github.com/calvinbrown32/JWA_2021/">this Github Repository</a>
<br>
<br>
</div>
</div>
</div>
    <br>


<script>

   // CREATE MAP OBJECT
    // var map = L.map('map');

    var map = L.map('map', {
    center: [45.55733331588203, -122.53807067871094],
    zoom: 12
    });

//=================================================

    // CREATE MAP PANES
    map.createPane('lirr');
        map.getPane('lirr').style.zIndex = 640;

    map.createPane('stops');
        map.getPane('stops').style.zIndex = 660;

    map.createPane('bus');
        map.getPane('bus').style.zIndex = 650;

    // This pane is above markers but below popups
    map.createPane('labels');
    map.getPane('labels').style.zIndex = 650;

    // Layers in this pane are non-interactive and do not obscure mouse/touch events
    map.getPane('labels').style.pointerEvents = 'none';

    //=============================================================



    // CREATE LAYER STYLES
    var geojsonMarkerOptions = {
    radius: 5,
    fillColor: "#ffffff",
    color: "#000",
    pane: "stops",
    weight: .5,
    opacity: 1,
    fillOpacity: 0.8
    };

    var geojsonMarkerOptionsOutbound = {
    radius: 5,
    fillColor: "#9595e2",
    color: "#000",
    pane: "stops",
    weight: .5,
    opacity: 1,
    fillOpacity: 0.8
    };

    var geojsonMarkerOptionsInbound = {
    radius: 5,
    fillColor: "#2b2bc4",
    color: "#000",
    pane: "stops",
    weight: .5,
    opacity: 1,
    fillOpacity: 0.8
};


//================================================================

    // CREATE LAYER GROUPS AND LAYERS

    var max_yellow_line = L.layerGroup().addTo(map);
    var route_2_inbound = L.layerGroup();
    var route_2_outbound = L.layerGroup();

       // ADD LAYERS To Layer Groups
       var route_2_inbound_io_stops =  L.geoJSON(route_2_inbound_io_stops, {
            onEachFeature: onEachFeature,
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, geojsonMarkerOptionsInbound);
            }
        }).addTo(route_2_inbound);

        var route_2_inbound_isos = L.geoJSON(route_2_inbound_io_isos, {
        onEachFeature: onEachFeature,
            color: "#5656fc",
            weight: 1.5,
            opacity: 7,
            pane: 'bus'
        }).addTo(route_2_inbound);

        var route2inboundline = L.geoJson(route2inboundline, {
            color: "#2b2bc4",
            weight: 2.5,
            opacity: 6,
            pane: 'bus'
        }).addTo(map);

       var max_stops = L.geoJSON(max_stops, {
            onEachFeature: onEachFeature,
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, geojsonMarkerOptions);
            }
        }).addTo(max_yellow_line);

       var max_line_isos = L.geoJSON(max_isos, {
        onEachFeature: onEachFeature,
        color: "#ffe978",
            weight: 3,
            opacity: 7,
            pane: 'lirr'
        }).addTo(max_yellow_line);

       var maxline = L.geoJson(maxline, {
        color: "#f9d831",
            weight: 4.5,
            opacity: 6,
            pane: 'lirr'
        }).addTo(map);

       var route_2_outbound_stops = L.geoJSON(route_2_outbound_stops, {
            onEachFeature: onEachFeature,
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, geojsonMarkerOptionsOutbound);
            }
        }).addTo(route_2_outbound);

       var route_2_outbound_isos = L.geoJSON(route_2_outbound_isos, {
            onEachFeature: onEachFeature,
            color: "#bdbdff",
            weight: 2,
            opacity: 7,
            pane: 'bus'
        }).addTo(route_2_outbound);

        var route2outboundline = L.geoJson(route2outboundline, {
                   color: "#9595e2",
                 weight: 2.5,
                      opacity: 6,
                      pane: 'bus'
       }).addTo(map);

   // LAYER CONTROL - ALLOWS LAYERS TO BE TOGGLED ON and OFF

   // leave blank basemaps variable so that leaflet creates layer control box correctly
   var basemaps = {
   };
   var overlays = {
          "Max Yellow Line": max_yellow_line,
          "2-Division Inbound":route_2_inbound,
          "2-Division Outbound":route_2_outbound
     };

//================================================


 // Message in Righthand corner saying to Click on Features
    var info = L.control();
            info.onAdd = function (map) {
                this._div = L.DomUtil.create('div', 'info');
                this.update();
                return this._div;
            };
            info.update = function (props) {
                this._div.innerHTML = '<b>Select a Transit Route using the button below <br> and click on individual stops for more info</b>';
            };
            info.addTo(map);




 // ADD ATTRIBUTION AND TILES TO MAP
    var cartodbAttribution = '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>';
    var positron = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
    attribution: cartodbAttribution
    }).addTo(map);

    var positronLabels = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png', {
    attribution: cartodbAttribution,
    pane: 'labels'
    }).addTo(map);

    // POP UP DATA FUNCTION
    function onEachFeature(feature, layer) {
		var popupContent = "" ;

        	if (feature.properties && feature.properties.stop_name) {
			popupContent += feature.properties.stop_name;
		}

		if (feature.properties && feature.properties.proportional_pop_comma) {
			popupContent += "<h6>" + (feature.properties.proportional_pop_comma) + " people live in the residential coverage area for this station</h6>";
		}

		layer.bindPopup(popupContent);
    };

// Any text between /* and */ will be ignored by JavaScript.

   // Function to highlight the object when the mouse hovers over isochrones
   // if (feature.properties.layer_type == "Isochrone") {



// HOVER AND CLICK FUNCTIONS



function highlightFeature(e) {
		var layer = e.target;

		layer.setStyle({
			weight: 5,
			color: '#666',
			dashArray: '',
			fillOpacity: 0.7
		});

		if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
			layer.bringToFront();
		}

	}



    function resetHighlight(e) {
            route_2_outbound_isos.resetStyle(e.target);
	}

	function zoomToFeature(e) {
		map.fitBounds(e.target.getBounds());
	}

	function onEachFeature(feature, layer) {
		if (feature.properties.layer_type == 'Isochrone') {
		layer.on({
			mouseover: highlightFeature,
			mouseout: resetHighlight,
			click: zoomToFeature
		});
		}
	}

//===============================================================

// Add Layer box.
L.control.layers(basemaps, overlays).addTo(map);


    //==================================

        // ADD LEGEND

        var legend = L.control({position: 'bottomright'});
        legend.onAdd = function (map) {
        var div = L.DomUtil.create('div', 'info legend');
        div.innerHTML = 'TriMet ' + '<br>' + '<span style="color:#2b2bc4;">──</span>  Route 2 Inbound' + '<br>' + '<span style="color:#9595e2;">──</span>  Route 2 Outbound'+ '<br>' + '<span style="color:#f9d831;">──</span>  MAX Yellow Line' ;
        return div;
        };
        legend.addTo(map);

</script>


<!-- The footer is straightforward and does not need to be modified. -->

  <footer>
  <div class="container">
    <div class="row">
      <div class="col">

        <ul class="list-inline text-center footer-links">

            <li class="list-inline-item">
                <a href="mailto:calvinbrown32@gmail.com" title="Email me"><span class="fa-stack                 fa-lg" aria-hidden="true">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                </span>
                <span class="sr-only">Email me</span>
              </a>
            </li>

            <li class="list-inline-item">
             <a href="https://twitter.com/calvinbrown32" title="Twitter"><span class="fa-stack               fa-lg" aria-hidden="true">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                </span>
                <span class="sr-only">Twitter</span>
              </a>
            </li>

            <li class="list-inline-item">
                <a href="https://www.instagram.com/calvindechicago" title="Instagram"><span                     class="fa-stack fa-lg" aria-hidden="true">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-instagram fa-stack-1x fa-inverse"></i>
                </span>
                <span class="sr-only">Instagram</span>
              </a>
            </li>

            <li class="list-inline-item">
                <a href="https://linkedin.com/in/calvin-brown-467b4b33" title="LinkedIn"><span                  class="fa-stack fa-lg" aria-hidden="true">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                </span>
                <span class="sr-only">LinkedIn</span>
              </a>
            </li>
        </ul>

      <p class="copyright text-muted">
      &nbsp;&bull;&nbsp;
      2021

      &nbsp;&bull;&nbsp;
      <a href="https://calvinbrown32.github.io">Calvin Brown</a>
      </p>

      </div>
    </div>
  </div>
</footer>

  </body>
</html>
